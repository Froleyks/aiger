#!/bin/sh

date=`./maxdate`
cvs ci -m 'release $date'
cvs tag -F rel-$date

doc="README FORMAT LICENSE"
impl="`ls *.c *.h|grep -v test`"
examples="`cd examples; ls *.c *.aig makefile|sed -e 's,^,examples/,'`"

files="$doc $impl $examples"

base="aiger-$date"
dir="/tmp/$base"
[ -d $dir ] && rm -rf $dir || exit 1

mkdir $dir || exit 1
mkdir $dir/examples || exit 1

sed -e '/^include test.mk/d' makefile > $dir/makefile

for f in $files
do
  cp $f $dir/$f
  echo $date > $dir/VERSION
done

cd /tmp
if [ -d $HOME/export ]
then
  zip="$HOME/export/${base}.zip"
else
  zip="/tmp/${base}.zip"
fi
rm -f $zip
zip -q -r $zip $base || exit 1
echo $zip
